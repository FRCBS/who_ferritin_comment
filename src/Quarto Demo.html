<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Esa Turkulainen">
<title>Quarto Demo: Ferritin thresholds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="Quarto Demo_files/libs/clipboard/clipboard.min.js"></script>
<script src="Quarto Demo_files/libs/quarto-html/quarto.js"></script>
<script src="Quarto Demo_files/libs/quarto-html/popper.min.js"></script>
<script src="Quarto Demo_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Quarto Demo_files/libs/quarto-html/anchor.min.js"></script>
<link href="Quarto Demo_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Quarto Demo_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Quarto Demo_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Quarto Demo_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Quarto Demo_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#quarto-is-the-new-r-markdown" id="toc-quarto-is-the-new-r-markdown" class="nav-link active" data-scroll-target="#quarto-is-the-new-r-markdown">Quarto is the new R Markdown</a></li>
  <li><a href="#defining-chunks" id="toc-defining-chunks" class="nav-link" data-scroll-target="#defining-chunks">Defining chunks</a></li>
  <li>
<a href="#measuring-ferritin-for-iron-deficiency" id="toc-measuring-ferritin-for-iron-deficiency" class="nav-link" data-scroll-target="#measuring-ferritin-for-iron-deficiency">Measuring ferritin for iron deficiency</a>
  <ul class="collapse">
<li>
<a href="#replication" id="toc-replication" class="nav-link" data-scroll-target="#replication">Replication</a>
  <ul class="collapse">
<li><a href="#h2000-data-visualized" id="toc-h2000-data-visualized" class="nav-link" data-scroll-target="#h2000-data-visualized">H2000 data visualized</a></li>
  </ul>
</li>
  <li>
<a href="#fitting-restricted-cubic-splines-health-2000" id="toc-fitting-restricted-cubic-splines-health-2000" class="nav-link" data-scroll-target="#fitting-restricted-cubic-splines-health-2000">Fitting restricted cubic splines | Health 2000</a>
  <ul class="collapse">
<li><a href="#findonor-data-visualized" id="toc-findonor-data-visualized" class="nav-link" data-scroll-target="#findonor-data-visualized">FinDonor data visualized</a></li>
  </ul>
</li>
  <li><a href="#fitting-restricted-cubic-splines-findonor" id="toc-fitting-restricted-cubic-splines-findonor" class="nav-link" data-scroll-target="#fitting-restricted-cubic-splines-findonor">Fitting restricted cubic splines | FinDonor</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Quarto Demo: Ferritin thresholds</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Esa Turkulainen </p>
          </div>
  </div>
    
    
  </div>
  

</header><div class="cell">
<details><summary>Packages</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://downlit.r-lib.org/">downlit</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/">rms</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="quarto-is-the-new-r-markdown" class="level2"><h2 class="anchored" data-anchor-id="quarto-is-the-new-r-markdown">Quarto is the new R Markdown</h2>
<p>Quarto (by R Studio) enables you to weave together content and executable code into a finished document. Still based on Pandoc, still rendered by Knitr, very much same ideas and philosophies, but now tailored to a wider audience and with less emphasis on R. To learn more about Quarto see <a href="https://quarto.org" class="uri">https://quarto.org</a>.</p>
</section><section id="defining-chunks" class="level2"><h2 class="anchored" data-anchor-id="defining-chunks">Defining chunks</h2>
<p>Instead of defining chunk behaviour in its initialization brackets, in Quarto documents (.qmd) we use the following notation:</p>
<div class="cell" data-layout-align="center">
<details><summary>Chunk notation</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: examples-settings</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Chunk notation</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: center</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># etc.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To achieve the rendering of the entire code block (with fences), we also used <code>#| echo: fenced</code> as a setting, but it itself does not get rendered. With <code>echo: true</code> we get the following:</p>
<div class="cell" data-layout-align="center">
<details><summary>Not fenced</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># etc.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="measuring-ferritin-for-iron-deficiency" class="level1 page-columns page-full"><h1>Measuring ferritin for iron deficiency</h1>
<p>The World Health Organization currently recommends a ferritin cut-off of &lt;15 μg/L for iron deficiency in all subpopulations, except children under 5 and pregnant individuals after the first trimester. [<a href="https://www.who.int/publications/i/item/9789240000124">1</a>] Although these numbers were “updated” in 2020, WHO couldn’t find strong evidence for using ferritin as a good marker for iron stores. They still recommend it, as there is high likelihood of it being better than not using it.</p>
<p>In 2021, to conjure some sense into this, Mei et al.&nbsp;[<a href="https://www.sciencedirect.com/science/article/abs/pii/S235230262100168X">2</a>] (affl. CDC) attempted to tie ferritin into two different physiological measures: hemoglobin and soluble transferritin receptors (sTfR), both indicators of iron-deficient erythropoiesis (layman: “not enough iron to make red blood cells”). They seem to argue that if they can find a similar threshold value for both of these by looking at ferritin, they can “derive a physiological ferritin threshold for iron deficiency”. Their cohort consists of “apparently healthy” children and non-pregnant women (15-49 yo) recorded in the US National Health and Nutrition Examination Survey (NHANES). For the purposes of their study, “apparently healthy” means filtering out individuals based on CRP, white blood cell counts, and possible liver disease.</p>
<p>To find this threshold, they chose a restricted cubic spline model with 5 knots. They do not report testing other numbers of knots, nor varying knot positions. In their Supplement they explain that they used the <code><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs()</a></code> function from the R package <code>rms</code> for this. We emailed them and they stated that they tested 4 and 5 knots, but because 5 knots returned a better <span class="math inline">\(R^2\)</span>, it was selected. We’re currently communicating with them, trying to see what happens when the number of knots is increased.</p>
<p>In this report we’ll focus on apparently healthy non-pregnant women (by recorded gender, pregnancy status and blood donor eligibility criteria available in the Health 2000 cohort), so here are the results for women in Mei et al.&nbsp;(reproduced without permission!):</p>
<p><img src="plot_women_mei_et_al.png" class="img-fluid" data-fig-align="center" alt="Serum ferritin threshold calculation for non-pregnant women"> Mei et al.&nbsp;determine the threshold by computing the zero derivatives of the resulting fits, implicitly arguing that the “plateau before the fall/rise” constitutes as the <em>de facto</em> threshold. The threshold generated this way are 25.2 μg/L and 24.0 μg/L for hemoglobin and sTfR, respectively. These vary somewhat when stratifying by age. It is however immediately interesting that these thresholds settle around the same number for both hemoglobin and sTfR, and that they defy the visual inspection of the scatter plot / median line, which points closer to the WHO threshold.</p>
<p>Later, in 2022, they replicated their results with Retrovirus Epidemiology Donor Study-II Donor Iron Status Evaluation (REDS-RISE) blood donor data (this time Addo et al.). [<a href="https://ashpublications.org/bloodadvances/article/6/12/3661/484681/Physiologically-based-serum-ferritin-thresholds">3</a>]</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="addo_et_al.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Concentration curve of serum ferritin against hemoglobin, and soluble transferrin receptor in a sample of women who are blood donors.</figcaption><p></p>
</figure>
</div>
<section id="replication" class="level2"><h2 class="anchored" data-anchor-id="replication">Replication</h2>
<p>We’re now left with a curiosity: what happens with other knot numbers? If we were to try to replicate this, we’d be interested in testing fits with more/less knots, or possibly entirely other approaches. We only have hemoglobin and ferritin to work with in the Health 200 cohort, but and hemoglobin, ferritin and sTfR in the FinDonor cohort. We’ll start with H2000.</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/load-data_7530dbda8cf44db22262ce5dbdbe1f75">

</div>
<section id="h2000-data-visualized" class="level3"><h3 class="anchored" data-anchor-id="h2000-data-visualized">H2000 data visualized</h3>
<p><a href="#fig-h2000-haemo">Figure&nbsp;1</a> shows the general relationship between haemoglobin and ferritin in the Health 2000 cohort. We can see that for a very short while, an increase in ferritin corresponds to a very strong increase in haemoglobin, after which it has no discernible effect. Here, we are interested in locating “with quantifiable confidence” the inflection point of this phenomenon.</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/fig-h2000-haemo_38d265ee8d4acce68ca0319939accd6a">
<details><summary>Plotting code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">apparently_healthy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ferritin</span>, y <span class="op">=</span> <span class="va">Hemoglobin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, formula <span class="op">=</span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">15</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"15 ug/L"</span>, x <span class="op">=</span> <span class="fl">7</span>, y <span class="op">=</span> <span class="fl">170</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"25 ug/L"</span>, x <span class="op">=</span> <span class="fl">34</span>, y <span class="op">=</span> <span class="fl">170</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"When will hemogobin start to fall off?"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Hemoglobin (g/L)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-h2000-haemo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-h2000-haemo-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Scatterplot of haemoglobin vs.&nbsp;ferritin of apparently healthy women aged 20-49</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Quarto tip!
</div>
</div>
<div class="callout-body-container callout-body">
<p>For plotting, you can set a caption with <code>fig-cap</code>, figure height and width with <code>fig-height</code> and <code>fig-width</code>, and alignment with <code>fig-align</code> (when knitting into HTML and LaTeX, Knitr will attempt to center the figure by default). You can cross-reference a figure using <code>@fig-*</code> notation, assuming you are also using a corresponding <code>label: fig-*</code>!</p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Getting called out
</div>
</div>
<div class="callout-body-container callout-body">
<p>These are callouts, and they come in a handful of flavors: <code>note</code>, <code>tip</code>, <code>warning</code>, <code>caution</code>, and <code>important</code>. You build them with the following syntax: <br><code>:::{.callout-note/tip/warning/caution/important}</code> <br><code>## Callout heading</code> <br><code>Content</code> <br><code>:::</code></p>
</div>
</div>
</section></section><section id="fitting-restricted-cubic-splines-health-2000" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="fitting-restricted-cubic-splines-health-2000">Fitting restricted cubic splines | Health 2000</h2>
<div class="cell">

</div>
<p>We first fit restricted cubic spline models with 3 to 12 knots, to see how their accuracies behave as measured by AIC.</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/fit-models-h2000_65130a045ace4a37541dced0bd94bebd">
<details><summary>Fitting with knots from 3 to 12</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hb3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">7</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">9</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">11</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hemoglobin</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">12</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">apparently_healthy</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To properly compare model AICs against each other, we rely on theory or a rule of thumb, outlined e.g.&nbsp;by Burnham and Anderson (2004). [<a href="http://faculty.washington.edu/skalski/classes/QERM597/papers_xtra/Burnham%20and%20Anderson.pdf">4</a>] Comparing AICs is best done by comparing their differences: <span class="math display">\[
\Delta_i = \text{AIC}_i - \text{AIC}_{min}.
\]</span> The rule of thumb goes as follows:</p>
<ul>
<li>
<span class="math inline">\(\Delta_i &lt; 2\)</span>: very probable that the <span class="math inline">\(i\)</span>th model describes the data as well as the model that minimizes AIC.</li>
<li>
<span class="math inline">\(2 &lt; \Delta_i &lt; 4\)</span>: strong evidence that the <span class="math inline">\(i\)</span>th model describes the data as well as the model that minimizes AIC.</li>
<li>
<span class="math inline">\(4 &lt; \Delta_i &lt; 7\)</span>: little evidence</li>
<li>
<span class="math inline">\(\Delta_i &gt; 10\)</span>: no contest</li>
</ul>
<p>Leveraging this logic, we can also compute the <em>relative probability</em> that the <span class="math inline">\(i\)</span>th method is actually the one that minimizes AIC: <span class="math display">\[
p_i = e^{\frac{-\Delta_i}{2}}.
\]</span> Knowing this, we may now compute the AIC differences and easily demonstrate the effect of knot numbers on the model performance.</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/compute-AIC-h2000_bf13a106ee0e535dc0c5bcf112307358">
<details><summary>Computing the AICs</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Hb_AIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb3</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb4</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb5</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb6</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb7</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb8</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb9</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb10</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb11</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Hb_AIC_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Hb_AIC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Hb_AIC_mindiff</span> <span class="op">&lt;-</span> <span class="va">Hb_AIC</span> <span class="op">-</span> <span class="va">Hb_AIC_min</span></span>
<span></span>
<span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">:</span><span class="fl">12</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Hb_AIC_mindiff</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">hb_AIC_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>knots <span class="op">=</span> <span class="va">knots</span>,</span>
<span>                        AIC_delta <span class="op">=</span> <span class="va">Hb_AIC_mindiff</span>,</span>
<span>                        probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Quarto-Demo_cache/html/fig-AIC-h2000_36af496e933553928207345371ea90cb">
<div class="cell-output-display">
<div id="fig-AIC-h2000" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-AIC-h2000-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Comparing AICs of restricted cubic spline models with varying numbers of knots. Health 2000 | Haemoglobin vs.&nbsp;Ferritin.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-AIC-h2000">Figure&nbsp;2</a> indicates that the AIC is minimized at 11 knots, after which it starts increasing again. Models with 10 and 12 knots are also very probable candidates for the actual AIC minimizing model, and we may not be able to reliably choose between them. If we set a confidence level of 5%, we’ll also have to include the 9 knot model. Let’s take a look at them.</p>
<div class="page-columns page-full">
<details><summary>Plotting fits</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rms/man/Predict.html">Predict</a></span><span class="op">(</span><span class="va">hb9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10.2</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"10.2 μg/L"</span>, x <span class="op">=</span> <span class="fl">17</span>, y <span class="op">=</span> <span class="fl">140</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>        geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>        label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AIC:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        x <span class="op">=</span> <span class="fl">110</span>,</span>
<span>        y <span class="op">=</span> <span class="fl">144</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Restricted cubic spline, 9 knots"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rms/man/Predict.html">Predict</a></span><span class="op">(</span><span class="va">hb10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">9.2</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"9.2 μg/L"</span>, x <span class="op">=</span> <span class="fl">16</span>, y <span class="op">=</span> <span class="fl">140</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>        geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>        label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AIC:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        x <span class="op">=</span> <span class="fl">110</span>,</span>
<span>        y <span class="op">=</span> <span class="fl">144</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Restricted cubic spline, 10 knots"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rms/man/Predict.html">Predict</a></span><span class="op">(</span><span class="va">hb11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">8.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"8.5 μg/L"</span>, x <span class="op">=</span> <span class="fl">15</span>, y <span class="op">=</span> <span class="fl">140</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>        geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>        label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AIC:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb11</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        x <span class="op">=</span> <span class="fl">110</span>,</span>
<span>        y <span class="op">=</span> <span class="fl">144</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Restricted cubic spline, 11 knots"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/rms/man/Predict.html">Predict</a></span><span class="op">(</span><span class="va">hb12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">8.3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"8.3 μg/L"</span>, x <span class="op">=</span> <span class="fl">14.8</span>, y <span class="op">=</span> <span class="fl">140</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>        geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>        label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AIC:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        x <span class="op">=</span> <span class="fl">110</span>,</span>
<span>        y <span class="op">=</span> <span class="fl">144</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span>,</span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Restricted cubic spline, 12 knots"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-selected-fits-h2000" class="cell column-page quarto-layout-panel" data-hash="Quarto-Demo_cache/html/fig-selected-fits-h2000_acff3cc01ad4b8805f3f04e93bee6bf8">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selected-fits-h2000-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-selected-fits-h2000-1.png" class="img-fluid figure-img" data-ref-parent="fig-selected-fits-h2000" width="672"></p>
<p></p><figcaption class="figure-caption">(a) 9 knots</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selected-fits-h2000-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-selected-fits-h2000-2.png" class="img-fluid figure-img" data-ref-parent="fig-selected-fits-h2000" width="672"></p>
<p></p><figcaption class="figure-caption">(b) 10 knots</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selected-fits-h2000-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-selected-fits-h2000-3.png" class="img-fluid figure-img" data-ref-parent="fig-selected-fits-h2000" width="672"></p>
<p></p><figcaption class="figure-caption">(c) 11 knots</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-selected-fits-h2000-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-selected-fits-h2000-4.png" class="img-fluid figure-img" data-ref-parent="fig-selected-fits-h2000" width="672"></p>
<p></p><figcaption class="figure-caption">(d) 12 knots</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Selected estricted cubic spline fits. Knots 9, 10, 11, and 12.</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-selected-fits-h2000">Figure&nbsp;3</a> (a, b, c, and d) clearly show that the inflection point or “plateau” we’re looking for (by finding the zero derivatives of this function!) shifts closer and closer to around 8 μg/L, as we move up in the number of knots. This result is somewhat striking for two reasons:</p>
<ol type="1">
<li>the ferritin thresholds derived this way are “way” below the WHO recommendation of 15 μg/L;</li>
<li>there is substantial movement in the placement of the inflection point depending on the number of knots, suggesting that this might also happen the NHANES data if tested.</li>
</ol>
<p>But we do have another cohort and another variable to test this with. The FinDonor cohort also includes the soluble transferrin receptor measurements for the participants, so we’ll be able to check if we can achieve a matching threshold between haemoglobin and sTfR.</p>
<section id="findonor-data-visualized" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="findonor-data-visualized">FinDonor data visualized</h3>
<div class="page-columns page-full">
<details><summary>Plotting data</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">donors_oi</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ferritin</span>, y <span class="op">=</span> <span class="va">Hb</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, formula <span class="op">=</span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">15</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"15 ug/L"</span>, x <span class="op">=</span> <span class="fl">7</span>, y <span class="op">=</span> <span class="fl">170</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"25 ug/L"</span>, x <span class="op">=</span> <span class="fl">34</span>, y <span class="op">=</span> <span class="fl">170</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"When will hemogobin start to fall off?"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Hemoglobin (g/L)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">donors_oi</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Ferritin</span>, y <span class="op">=</span> <span class="va">TransferrinR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, formula <span class="op">=</span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">x</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">15</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">25</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"15 ug/L"</span>, x <span class="op">=</span> <span class="fl">7</span>, y <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"25 ug/L"</span>, x <span class="op">=</span> <span class="fl">34</span>, y <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"When will sTfR start to rise?"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"sTfR (mg/L)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-findonor-viz" class="cell column-page quarto-layout-panel" data-hash="Quarto-Demo_cache/html/fig-findonor-viz_6bfa2014ebf864c03c3590bad4793f62">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-findonor-viz-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-findonor-viz-1.png" class="img-fluid figure-img" data-ref-parent="fig-findonor-viz" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Haemoglobin</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-findonor-viz-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-findonor-viz-2.png" class="img-fluid figure-img" data-ref-parent="fig-findonor-viz" width="672"></p>
<p></p><figcaption class="figure-caption">(b) sTfR</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Scatterplot of haemoglobin, ferritin and transferrin receptor values in donating women aged 20-49</figcaption><p></p>
</figure>
</div>
</div>
<p>The inflection points for both haemoglobin and sTfR are not as clear as with haemoglobin in the Health 200 cohort. This is probably a donor selection process effect.</p>
</section></section><section id="fitting-restricted-cubic-splines-findonor" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="fitting-restricted-cubic-splines-findonor">Fitting restricted cubic splines | FinDonor</h2>
<div class="cell">

</div>
<div class="cell" data-hash="Quarto-Demo_cache/html/fit-models-h2000-haem_da6367738eebc447ad638df8f181a8b2">
<details><summary>Fitting with knots from 3 to 12 | Haemoglobin</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hb3_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb4_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb5_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb6_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb7_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">7</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb8_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb9_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">9</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb10_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb11_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">11</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hb12_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">Hb</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">12</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Quarto-Demo_cache/html/fit-models-h2000-stfr_f53d399fb8fbc1cce074925b87174e04">
<details><summary>Fitting with knots from 3 to 12 | sTfR</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stfr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">7</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">8</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr9</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">9</span><span class="op">)</span>, </span>
<span>           data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>           x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>           y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">11</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">stfr12</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/ols.html">ols</a></span><span class="op">(</span><span class="va">TransferrinR</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html">rcs</a></span><span class="op">(</span><span class="va">Ferritin</span>, <span class="fl">12</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="va">donors_oi</span>, </span>
<span>            x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Quarto-Demo_cache/html/compute-AIC-FinDonor-haem_1e641a4466e91c4b181756b054615d0c">
<details><summary>Computing the AICs | Haemoglobin</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Hb_AIC_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb3_fd</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb4_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb5_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb6_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb7_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb8_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb9_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb10_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb11_fd</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">hb12_fd</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Hb_AIC_min_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">Hb_AIC_fd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Hb_AIC_mindiff_fd</span> <span class="op">&lt;-</span> <span class="va">Hb_AIC_fd</span> <span class="op">-</span> <span class="va">Hb_AIC_min_fd</span></span>
<span></span>
<span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">:</span><span class="fl">12</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">Hb_AIC_mindiff_fd</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">hb_AIC_df_fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>knots <span class="op">=</span> <span class="va">knots</span>,</span>
<span>                        AIC_delta <span class="op">=</span> <span class="va">Hb_AIC_mindiff_fd</span>,</span>
<span>                        probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="Quarto-Demo_cache/html/compute-AIC-FinDonor-stfr_85311044aa504227df56b558eadfe6ba">
<details><summary>Computing the AICs | sTfR</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">stfr_AIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr3</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr4</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr5</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr6</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr7</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr8</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr9</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr10</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr11</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">stfr12</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stfr_AIC_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">stfr_AIC</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stfr_AIC_mindiff</span> <span class="op">&lt;-</span> <span class="va">stfr_AIC</span> <span class="op">-</span> <span class="va">stfr_AIC_min</span></span>
<span></span>
<span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">:</span><span class="fl">12</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">stfr_AIC_mindiff</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">stfr_AIC_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>knots <span class="op">=</span> <span class="va">knots</span>,</span>
<span>                        AIC_delta <span class="op">=</span> <span class="va">stfr_AIC_mindiff</span>,</span>
<span>                        probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-AIC-FinDonor" class="cell column-page quarto-layout-panel" data-hash="Quarto-Demo_cache/html/fig-AIC-FinDonor_b16259aec368d90dfef8027b5b2da4d2">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-AIC-FinDonor-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-AIC-FinDonor-1.png" class="img-fluid figure-img" data-ref-parent="fig-AIC-FinDonor" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Haemoglobin</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-AIC-FinDonor-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-AIC-FinDonor-2.png" class="img-fluid figure-img" data-ref-parent="fig-AIC-FinDonor" width="672"></p>
<p></p><figcaption class="figure-caption">(b) sTfR</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Comparing AICs of restricted cubic spline models with varying numbers of knots. FinDonor.</figcaption><p></p>
</figure>
</div>
<p><a href="#fig-AIC-FinDonor">Figure&nbsp;5</a> reveals that the AIC is minimized at different knots for haemoglobin and sTfR, 5 and 7, respectively. However, the haemoglobin 7 knot model has still quite a lot of support for it, being at 39% chance of being the AIC minimizing model. The evidence gets weaker fast, though, as we move up the knot ladder.</p>
<p>We probably shouldn’t be encouraged to move upwards the model complexity curve just because we can credibly match knot numbers for two different iron deficiency indicators, but let’s see what the 7 knot models look like.</p>
<div id="fig-FinDonor-7s" class="cell column-page quarto-layout-panel" data-hash="Quarto-Demo_cache/html/fig-FinDonor-7s_f9262a6584ba3caa1db061c2cc665216">
<figure class="figure"><div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-FinDonor-7s-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-FinDonor-7s-1.png" class="img-fluid figure-img" data-ref-parent="fig-FinDonor-7s" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Haemoglobin</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-FinDonor-7s-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-FinDonor-7s-2.png" class="img-fluid figure-img" data-ref-parent="fig-FinDonor-7s" width="672"></p>
<p></p><figcaption class="figure-caption">(b) sTfR</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: 7 knot models for the FinDonor cohort (haemoglobin and sTfR)</figcaption><p></p>
</figure>
</div>
<p>It’s encouraging that the threshold is around the same ballpark for both of these at knot number 7. However, let us not forget the reality of the matter, there are other viable fits available:</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/fig-FinDonor-haem-5_2718bd1e6ffc678813853c844593f0bf">
<div class="cell-output-display">
<div id="fig-FinDonor-haem-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-FinDonor-haem-5-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: 5 knot model for haemoglobin (FinDonor)</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-FinDonor-haem-5">Figure&nbsp;7</a> reveals that there are no zero derivatives within the range of interest for haemoglobin with 5 knots! There still is a turning point, but it can’t be found via the zero of the first derivative of this function. Looking at the derivatives at select <code>x</code> (the estimates here are visual), we can see that the change in the derivative is fastest somewhere between 15 and 20 μg/L.</p>
<p>This is isn’t the only fit with no plateau at the inflection point. Take a look at the sTfR 9 knot model:</p>
<div class="cell" data-hash="Quarto-Demo_cache/html/fig-FinDonor-stfr-9_67ef4bdf94e6a4d077ce08151ce90d4d">
<div class="cell-output-display">
<div id="fig-FinDonor-stfr-9" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Quarto-Demo_files/figure-html/fig-FinDonor-stfr-9-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: 9 knot model for sTfR (FinDonor)</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="summary" class="level2"><h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>We’re currently in talks with the original authors of these cubic spline derived thresholds, but the communication has not been very clear. We sent them our code to run this week, but have yet to heard from them.</p>
<p>The main issue here is that if we suppose that there is a piecewise linear relationship between markers for iron-deficient erythropoiesis and serum ferritin levels, the whole idea of a zero derivative plateau makes no sense and raises the question of it being an artifact of the cubic spline model. We only expect to see a range where there is an effect, and a subsequent range where the effect disappears. Quantifying the behaviour of the derivative at the inflection point in a way that would be of use to anyone is much more difficult. Furthermore, different model specifications will position the inflection point differently, and we may want to instead distribut-ize the model parameters and extract the inflection points from those specifications that lie at the boundaries of our credibility intervals. This would require Bayesian modeling, an area I’m currently researching for this.</p>
</section><section id="references" class="level2"><h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li>World Health Organization. (2020). WHO guideline on use of ferritin concentrations to assess iron status in populations. World Health Organization. ISBN: 978-92-4-000012-4</li>
<li>Mei Z, Addo OY, Jefferds ME, Sharma AJ, Flores-Ayala RC, Brittenham GM. Physiologically based serum ferritin thresholds for iron deficiency in children and non-pregnant women: a US National Health and Nutrition Examination Surveys (NHANES) serial cross-sectional study. The Lancet Haematology. 2021;8(8):e572-e582. doi:10.1016/S2352-3026(21)00168-X</li>
<li>Addo OY, Mei Z, Hod EA, et al.&nbsp;Physiologically based serum ferritin thresholds for iron deficiency in women of reproductive age who are blood donors. Blood Advances. 2022;6(12):3661-3665. doi:10.1182/bloodadvances.2022007066</li>
<li>Burnham KP, Anderson DR. Multimodel inference: understanding AIC and BIC in model selection. Sociological methods &amp; research. 2004;33(2):261-304. doi:10.1177/0049124104268644</li>
</ol>
<!-- -->
</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb13" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Quarto Demo: Ferritin thresholds"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Esa Turkulainen"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">        code-tools: true</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">        code-link: true</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> cosmo</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-packages</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Packages</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(downlit)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quarto is the new R Markdown</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>Quarto (by R Studio) enables you to weave together content and executable code into a finished document. Still based on Pandoc, still rendered by Knitr, very much same ideas and philosophies, but now tailored to a wider audience and with less emphasis on R. To learn more about Quarto see <span class="ot">&lt;https://quarto.org&gt;</span>.</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Defining chunks</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>Instead of defining chunk behaviour in its initialization brackets, in Quarto documents (.qmd) we use the following notation:</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: examples-settings</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Chunk notation</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: fenced</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: center</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co"># etc.</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>To achieve the rendering of the entire code block (with fences), we also used <span class="in">`#| echo: fenced`</span> as a setting, but it itself does not get rendered. With <span class="in">`echo: true`</span> we get the following:</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: examples-settings-echo-true</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Not fenced</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.align: center</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># etc.</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="fu"># Measuring ferritin for iron deficiency</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>The World Health Organization currently recommends a ferritin cut-off of <span class="sc">\&lt;</span>15 μg/L for iron deficiency in all subpopulations, except children under 5 and pregnant individuals after the first trimester. <span class="sc">\[</span><span class="co">[</span><span class="ot">1</span><span class="co">](https://www.who.int/publications/i/item/9789240000124)</span><span class="sc">\]</span> Although these numbers were "updated" in 2020, WHO couldn't find strong evidence for using ferritin as a good marker for iron stores. They still recommend it, as there is high likelihood of it being better than not using it.</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>In 2021, to conjure some sense into this, Mei et al. <span class="sc">\[</span><span class="co">[</span><span class="ot">2</span><span class="co">](https://www.sciencedirect.com/science/article/abs/pii/S235230262100168X)</span><span class="sc">\]</span> (affl. CDC) attempted to tie ferritin into two different physiological measures: hemoglobin and soluble transferritin receptors (sTfR), both indicators of iron-deficient erythropoiesis (layman: "not enough iron to make red blood cells"). They seem to argue that if they can find a similar threshold value for both of these by looking at ferritin, they can "derive a physiological ferritin threshold for iron deficiency". Their cohort consists of "apparently healthy" children and non-pregnant women (15-49 yo) recorded in the US National Health and Nutrition Examination Survey (NHANES). For the purposes of their study, "apparently healthy" means filtering out individuals based on CRP, white blood cell counts, and possible liver disease.</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>To find this threshold, they chose a restricted cubic spline model with 5 knots. They do not report testing other numbers of knots, nor varying knot positions. In their Supplement they explain that they used the <span class="in">`rcs()`</span> function from the R package <span class="in">`rms`</span> for this. We emailed them and they stated that they tested 4 and 5 knots, but because 5 knots returned a better $R^2$, it was selected. We're currently communicating with them, trying to see what happens when the number of knots is increased.</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>In this report we'll focus on apparently healthy non-pregnant women (by recorded gender, pregnancy status and blood donor eligibility criteria available in the Health 2000 cohort), so here are the results for women in Mei et al. (reproduced without permission!):</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="al">![Serum ferritin threshold calculation for non-pregnant women](plot_women_mei_et_al.png)</span>{fig-align="center"}</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>Mei et al. determine the threshold by computing the zero derivatives of the resulting fits, implicitly arguing that the "plateau before the fall/rise" constitutes as the _de facto_ threshold. The threshold generated this way are 25.2 μg/L and 24.0 μg/L for hemoglobin and sTfR, respectively. These vary somewhat when stratifying by age. It is however immediately interesting that these thresholds settle around the same number for both hemoglobin and sTfR, and that they defy the visual inspection of the scatter plot / median line, which points closer to the WHO threshold.</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>Later, in 2022, they replicated their results with Retrovirus Epidemiology Donor Study-II Donor Iron Status Evaluation (REDS-RISE) blood donor data (this time Addo et al.). [<span class="co">[</span><span class="ot">3</span><span class="co">](https://ashpublications.org/bloodadvances/article/6/12/3661/484681/Physiologically-based-serum-ferritin-thresholds)</span>] </span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="al">![Concentration curve of serum ferritin against hemoglobin, and soluble transferrin receptor in a sample of women who are blood donors.](addo_et_al.png)</span>{fig-align="center"}</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## Replication</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>We're now left with a curiosity: what happens with other knot numbers? If we were to try to replicate this, we'd be interested in testing fits with more/less knots, or possibly entirely other approaches. We only have hemoglobin and ferritin to work with in the Health 200 cohort, but and hemoglobin, ferritin and sTfR in the FinDonor cohort. We'll start with H2000.</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Load THL data</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"~/CRP_enrichment/data/thldata.rdata"</span>)</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>H2000 <span class="ot">&lt;-</span> thldata<span class="sc">$</span>h2000</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove leftovers</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(thldata)</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>H2000 <span class="ot">&lt;-</span> <span class="fu">rename</span>(H2000, <span class="at">Ferritin =</span> FERRITIINI, <span class="at">Hemoglobin =</span> B_Hb)</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a><span class="co"># These are approximations of donation limitations</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>apparently_healthy <span class="ot">&lt;-</span> H2000 <span class="sc">%&gt;%</span> </span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BMII_PAINO.x <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> BMII_PAINO.x <span class="sc">&lt;=</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> <span class="co"># Filter away people &lt;50kg and &gt;200kg</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(IKA2 <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> IKA2 <span class="sc">&lt;=</span> <span class="dv">49</span>) <span class="sc">%&gt;%</span> <span class="co"># Filter away too young and too old</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(SP2 <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out men</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BD07 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out pregnant women</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BA08 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out people with heart attacks</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BA09 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out people with angina</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BA10 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># cardiac insufficiency / heart failure</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(BA26 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> ATC_A10A <span class="sc">==</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="co"># filter out people who are diabetic AND use insulin</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(BA01 <span class="sc">&lt;</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out "Bad" or "Very bad" SRH</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">GlycA =</span> GP) <span class="sc">%&gt;%</span> <span class="co"># rename for ease of use</span></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">HbA1C =</span> B_GHb_A1C <span class="sc">*</span> <span class="fl">10.93</span> <span class="sc">-</span> <span class="fl">23.50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Ferritin, Hemoglobin)</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data on individual donations</span></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"~/CRP_enrichment/data/r02.fd.bd.all.rdata"</span>) <span class="co"># outputs an object called "output" into the environment</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>donations <span class="ot">&lt;-</span> output</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a><span class="co"># We only want to look at first donation event values from each donor</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>donors <span class="ot">&lt;-</span> donations <span class="sc">%&gt;%</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(donor) <span class="sc">%&gt;%</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(date <span class="sc">==</span> <span class="fu">min</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Load FinDonor demographic data</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"~/CRP_enrichment/data/r02ds.donorData.rdata"</span>) <span class="co"># outputs an object called "output" into the environment</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>findonor <span class="ot">&lt;-</span> output</span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the FinDonor datasets</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>FinDonor <span class="ot">&lt;-</span> <span class="fu">left_join</span>(donors, findonor, <span class="at">by =</span> <span class="st">"donor"</span>)</span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter</span></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>donors_oi <span class="ot">&lt;-</span> FinDonor <span class="sc">%&gt;%</span></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">49</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">"Women"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Hb, Ferritin, TransferrinR)</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### H2000 data visualized</span></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>@fig-h2000-haemo shows the general relationship between haemoglobin and ferritin in the Health 2000 cohort. We can see that for a very short while, an increase in ferritin corresponds to a very strong increase in haemoglobin, after which it has no discernible effect. Here, we are interested in locating "with quantifiable confidence" the inflection point of this phenomenon.</span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-h2000-haemo</span></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Plotting code</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scatterplot of haemoglobin vs. ferritin of apparently healthy women aged 20-49"</span></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> apparently_healthy, <span class="fu">aes</span>(<span class="at">x =</span> Ferritin, <span class="at">y =</span> Hemoglobin)) <span class="sc">+</span> </span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">formula =</span>  y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cr"</span>)) <span class="sc">+</span></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"15 ug/L"</span>, <span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"25 ug/L"</span>, <span class="at">x =</span> <span class="dv">34</span>, <span class="at">y =</span> <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"When will hemogobin start to fall off?"</span>,</span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Hemoglobin (g/L)"</span>)</span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quarto tip!</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>For plotting, you can set a caption with <span class="in">`fig-cap`</span>, figure height and width with <span class="in">`fig-height`</span> and <span class="in">`fig-width`</span>, and alignment with <span class="in">`fig-align`</span> (when knitting into HTML and LaTeX, Knitr will attempt to center the figure by default). You can cross-reference a figure using <span class="in">`@fig-*`</span> notation, assuming you are also using a corresponding <span class="in">`label: fig-*`</span>!</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting called out</span></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>These are callouts, and they come in a handful of flavors: <span class="in">`note`</span>, <span class="in">`tip`</span>, <span class="in">`warning`</span>, <span class="in">`caution`</span>, and <span class="in">`important`</span>. You build them with the following syntax: <span class="kw">&lt;br</span> <span class="kw">/&gt;</span></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a><span class="in">`:::{.callout-note/tip/warning/caution/important}`</span> <span class="kw">&lt;br</span> <span class="kw">/&gt;</span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a><span class="in">`## Callout heading`</span> <span class="kw">&lt;br</span> <span class="kw">/&gt;</span></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a><span class="in">`Content`</span> <span class="kw">&lt;br</span> <span class="kw">/&gt;</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a><span class="in">`:::`</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting restricted cubic splines | Health 2000</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: set-datadist</span></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(apparently_healthy)</span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a>We first fit restricted cubic spline models with 3 to 12 knots, to see how their accuracies behave as measured by AIC.</span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-models-h2000</span></span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Fitting with knots from 3 to 12</span></span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true" tabindex="-1"></a>hb3 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">3</span>), </span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true" tabindex="-1"></a>hb4 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">4</span>), </span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true" tabindex="-1"></a>hb5 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">5</span>), </span>
<span id="cb13-220"><a href="#cb13-220" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-221"><a href="#cb13-221" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true" tabindex="-1"></a>hb6 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">6</span>), </span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true" tabindex="-1"></a>hb7 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">7</span>), </span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true" tabindex="-1"></a>hb8 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">8</span>), </span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true" tabindex="-1"></a>hb9 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">9</span>), </span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true" tabindex="-1"></a>hb10 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">10</span>), </span>
<span id="cb13-240"><a href="#cb13-240" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-241"><a href="#cb13-241" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-242"><a href="#cb13-242" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-243"><a href="#cb13-243" aria-hidden="true" tabindex="-1"></a>hb11 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">11</span>), </span>
<span id="cb13-244"><a href="#cb13-244" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-245"><a href="#cb13-245" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-246"><a href="#cb13-246" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-247"><a href="#cb13-247" aria-hidden="true" tabindex="-1"></a>hb12 <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hemoglobin <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">12</span>), </span>
<span id="cb13-248"><a href="#cb13-248" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> apparently_healthy, </span>
<span id="cb13-249"><a href="#cb13-249" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-250"><a href="#cb13-250" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-251"><a href="#cb13-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-252"><a href="#cb13-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-253"><a href="#cb13-253" aria-hidden="true" tabindex="-1"></a>To properly compare model AICs against each other, we rely on theory or a rule of thumb, outlined e.g. by Burnham and Anderson (2004). <span class="sc">\[</span><span class="co">[</span><span class="ot">4</span><span class="co">](http://faculty.washington.edu/skalski/classes/QERM597/papers_xtra/Burnham%20and%20Anderson.pdf)</span><span class="sc">\]</span> Comparing AICs is best done by comparing their differences:</span>
<span id="cb13-254"><a href="#cb13-254" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-255"><a href="#cb13-255" aria-hidden="true" tabindex="-1"></a>\Delta_i = \text{AIC}_i - \text{AIC}_{min}.</span>
<span id="cb13-256"><a href="#cb13-256" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-257"><a href="#cb13-257" aria-hidden="true" tabindex="-1"></a>The rule of thumb goes as follows:</span>
<span id="cb13-258"><a href="#cb13-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-259"><a href="#cb13-259" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\Delta_i &lt; 2$: very probable that the $i$th model describes the data as well as the model that minimizes AIC.</span>
<span id="cb13-260"><a href="#cb13-260" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$2 &lt; \Delta_i &lt; 4$: strong evidence that the $i$th model describes the data as well as the model that minimizes AIC.</span>
<span id="cb13-261"><a href="#cb13-261" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$4 &lt; \Delta_i &lt; 7$: little evidence</span>
<span id="cb13-262"><a href="#cb13-262" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\Delta_i &gt; 10$: no contest</span>
<span id="cb13-263"><a href="#cb13-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-264"><a href="#cb13-264" aria-hidden="true" tabindex="-1"></a>Leveraging this logic, we can also compute the _relative probability_ that the $i$th method is actually the one that minimizes AIC:</span>
<span id="cb13-265"><a href="#cb13-265" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true" tabindex="-1"></a>p_i = e^{\frac{-\Delta_i}{2}}.</span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true" tabindex="-1"></a>Knowing this, we may now compute the AIC differences and easily demonstrate the effect of knot numbers on the model performance.</span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-AIC-h2000</span></span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Computing the AICs</span></span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true" tabindex="-1"></a>Hb_AIC <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">AIC</span>(hb3),</span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb4), </span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb5), </span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb6), </span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb7), </span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb8), </span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb9), </span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb10), </span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb11), </span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb12))</span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true" tabindex="-1"></a>Hb_AIC_min <span class="ot">&lt;-</span> <span class="fu">min</span>(Hb_AIC)</span>
<span id="cb13-289"><a href="#cb13-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-290"><a href="#cb13-290" aria-hidden="true" tabindex="-1"></a>Hb_AIC_mindiff <span class="ot">&lt;-</span> Hb_AIC <span class="sc">-</span> Hb_AIC_min</span>
<span id="cb13-291"><a href="#cb13-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-292"><a href="#cb13-292" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb13-293"><a href="#cb13-293" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>Hb_AIC_mindiff <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb13-294"><a href="#cb13-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a>hb_AIC_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">knots =</span> knots,</span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a>                        <span class="at">AIC_delta =</span> Hb_AIC_mindiff,</span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probs =</span> probs)</span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-AIC-h2000</span></span>
<span id="cb13-304"><a href="#cb13-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-305"><a href="#cb13-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-306"><a href="#cb13-306" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Comparing AICs of restricted cubic spline models with varying numbers of knots. Health 2000 | Haemoglobin vs. Ferritin.</span></span>
<span id="cb13-307"><a href="#cb13-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-308"><a href="#cb13-308" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> hb_AIC_df, <span class="fu">aes</span>(<span class="at">x =</span> knots, </span>
<span id="cb13-309"><a href="#cb13-309" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> AIC_delta)) <span class="sc">+</span></span>
<span id="cb13-310"><a href="#cb13-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-311"><a href="#cb13-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span>, </span>
<span id="cb13-312"><a href="#cb13-312" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-313"><a href="#cb13-313" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-314"><a href="#cb13-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span>, </span>
<span id="cb13-315"><a href="#cb13-315" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-316"><a href="#cb13-316" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb13-317"><a href="#cb13-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">7</span>, </span>
<span id="cb13-318"><a href="#cb13-318" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-319"><a href="#cb13-319" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"yellow"</span>) <span class="sc">+</span></span>
<span id="cb13-320"><a href="#cb13-320" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparing AICs of restricted cubic spline models"</span>,</span>
<span id="cb13-321"><a href="#cb13-321" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Health 2000 | Haemoglobin ~ Ferritin"</span>,</span>
<span id="cb13-322"><a href="#cb13-322" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of knots in an RCS model"</span>,</span>
<span id="cb13-323"><a href="#cb13-323" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">bquote</span>(Delta[i] <span class="sc">~</span> <span class="st">" = "</span> <span class="sc">~</span> AIC[min] <span class="sc">~</span> <span class="st">" - "</span> <span class="sc">~</span> AIC[i])) <span class="sc">+</span></span>
<span id="cb13-324"><a href="#cb13-324" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb13-325"><a href="#cb13-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb13-326"><a href="#cb13-326" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> knots, <span class="at">y =</span> AIC_delta <span class="sc">+</span> <span class="dv">3</span>, <span class="at">xend =</span> knots, <span class="at">yend =</span> AIC_delta <span class="sc">+</span> <span class="dv">8</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb13-327"><a href="#cb13-327" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(probs, <span class="dv">2</span>), <span class="st">"%"</span>)), <span class="at">nudge_y =</span> <span class="dv">10</span>, <span class="at">nudge_x =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb13-328"><a href="#cb13-328" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb13-329"><a href="#cb13-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-330"><a href="#cb13-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-331"><a href="#cb13-331" aria-hidden="true" tabindex="-1"></a>@fig-AIC-h2000 indicates that the AIC is minimized at 11 knots, after which it starts increasing again. Models with 10 and 12 knots are also very probable candidates for the actual AIC minimizing model, and we may not be able to reliably choose between them. If we set a confidence level of 5\%, we'll also have to include the 9 knot model. Let's take a look at them.</span>
<span id="cb13-332"><a href="#cb13-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-335"><a href="#cb13-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-336"><a href="#cb13-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-selected-fits-h2000</span></span>
<span id="cb13-337"><a href="#cb13-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-338"><a href="#cb13-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Plotting fits</span></span>
<span id="cb13-339"><a href="#cb13-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-340"><a href="#cb13-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Selected estricted cubic spline fits. Knots 9, 10, 11, and 12.</span></span>
<span id="cb13-341"><a href="#cb13-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb13-342"><a href="#cb13-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| - 9 knots</span></span>
<span id="cb13-343"><a href="#cb13-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| - 10 knots</span></span>
<span id="cb13-344"><a href="#cb13-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| - 11 knots</span></span>
<span id="cb13-345"><a href="#cb13-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| - 12 knots</span></span>
<span id="cb13-346"><a href="#cb13-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb13-347"><a href="#cb13-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb13-348"><a href="#cb13-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-349"><a href="#cb13-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-350"><a href="#cb13-350" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb9)) <span class="sc">+</span></span>
<span id="cb13-351"><a href="#cb13-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">10.2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-352"><a href="#cb13-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"10.2 μg/L"</span>, <span class="at">x =</span> <span class="dv">17</span>, <span class="at">y =</span> <span class="dv">140</span>) <span class="sc">+</span></span>
<span id="cb13-353"><a href="#cb13-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-354"><a href="#cb13-354" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-355"><a href="#cb13-355" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb9))),</span>
<span id="cb13-356"><a href="#cb13-356" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-357"><a href="#cb13-357" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-358"><a href="#cb13-358" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-359"><a href="#cb13-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-360"><a href="#cb13-360" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-361"><a href="#cb13-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-362"><a href="#cb13-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-363"><a href="#cb13-363" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 9 knots"</span>,</span>
<span id="cb13-364"><a href="#cb13-364" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span id="cb13-365"><a href="#cb13-365" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-366"><a href="#cb13-366" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-367"><a href="#cb13-367" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-368"><a href="#cb13-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-369"><a href="#cb13-369" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb10)) <span class="sc">+</span></span>
<span id="cb13-370"><a href="#cb13-370" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">9.2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-371"><a href="#cb13-371" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"9.2 μg/L"</span>, <span class="at">x =</span> <span class="dv">16</span>, <span class="at">y =</span> <span class="dv">140</span>) <span class="sc">+</span></span>
<span id="cb13-372"><a href="#cb13-372" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-373"><a href="#cb13-373" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-374"><a href="#cb13-374" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb10))),</span>
<span id="cb13-375"><a href="#cb13-375" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-376"><a href="#cb13-376" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-377"><a href="#cb13-377" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-378"><a href="#cb13-378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-379"><a href="#cb13-379" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-380"><a href="#cb13-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-381"><a href="#cb13-381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-382"><a href="#cb13-382" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 10 knots"</span>,</span>
<span id="cb13-383"><a href="#cb13-383" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span id="cb13-384"><a href="#cb13-384" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-385"><a href="#cb13-385" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-386"><a href="#cb13-386" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-387"><a href="#cb13-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-388"><a href="#cb13-388" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb11)) <span class="sc">+</span></span>
<span id="cb13-389"><a href="#cb13-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">8.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-390"><a href="#cb13-390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"8.5 μg/L"</span>, <span class="at">x =</span> <span class="dv">15</span>, <span class="at">y =</span> <span class="dv">140</span>) <span class="sc">+</span></span>
<span id="cb13-391"><a href="#cb13-391" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-392"><a href="#cb13-392" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-393"><a href="#cb13-393" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb11))),</span>
<span id="cb13-394"><a href="#cb13-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-395"><a href="#cb13-395" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-396"><a href="#cb13-396" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-397"><a href="#cb13-397" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-398"><a href="#cb13-398" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-399"><a href="#cb13-399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-400"><a href="#cb13-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-401"><a href="#cb13-401" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 11 knots"</span>,</span>
<span id="cb13-402"><a href="#cb13-402" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span id="cb13-403"><a href="#cb13-403" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-404"><a href="#cb13-404" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-405"><a href="#cb13-405" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-406"><a href="#cb13-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-407"><a href="#cb13-407" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb12)) <span class="sc">+</span></span>
<span id="cb13-408"><a href="#cb13-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">8.3</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-409"><a href="#cb13-409" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"8.3 μg/L"</span>, <span class="at">x =</span> <span class="fl">14.8</span>, <span class="at">y =</span> <span class="dv">140</span>) <span class="sc">+</span></span>
<span id="cb13-410"><a href="#cb13-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-411"><a href="#cb13-411" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-412"><a href="#cb13-412" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb12))),</span>
<span id="cb13-413"><a href="#cb13-413" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-414"><a href="#cb13-414" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-415"><a href="#cb13-415" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-416"><a href="#cb13-416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-417"><a href="#cb13-417" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-418"><a href="#cb13-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-419"><a href="#cb13-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-420"><a href="#cb13-420" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 12 knots"</span>,</span>
<span id="cb13-421"><a href="#cb13-421" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Apparently healthy non-pregnant women 20-49 y.o."</span>,</span>
<span id="cb13-422"><a href="#cb13-422" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-423"><a href="#cb13-423" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-424"><a href="#cb13-424" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-425"><a href="#cb13-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-426"><a href="#cb13-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-427"><a href="#cb13-427" aria-hidden="true" tabindex="-1"></a>@fig-selected-fits-h2000 (a, b, c, and d) clearly show that the inflection point or "plateau" we're looking for (by finding the zero derivatives of this function!) shifts closer and closer to around 8 μg/L, as we move up in the number of knots. This result is somewhat striking for two reasons: </span>
<span id="cb13-428"><a href="#cb13-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-429"><a href="#cb13-429" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>the ferritin thresholds derived this way are "way" below the WHO recommendation of 15 μg/L;</span>
<span id="cb13-430"><a href="#cb13-430" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>there is substantial movement in the placement of the inflection point depending on the number of knots, suggesting that this might also happen the NHANES data if tested.</span>
<span id="cb13-431"><a href="#cb13-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-432"><a href="#cb13-432" aria-hidden="true" tabindex="-1"></a>But we do have another cohort and another variable to test this with. The FinDonor cohort also includes the soluble transferrin receptor measurements for the participants, so we'll be able to check if we can achieve a matching threshold between haemoglobin and sTfR.</span>
<span id="cb13-433"><a href="#cb13-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-434"><a href="#cb13-434" aria-hidden="true" tabindex="-1"></a><span class="fu">### FinDonor data visualized</span></span>
<span id="cb13-435"><a href="#cb13-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-438"><a href="#cb13-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-439"><a href="#cb13-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-findonor-viz</span></span>
<span id="cb13-440"><a href="#cb13-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-441"><a href="#cb13-441" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Plotting data</span></span>
<span id="cb13-442"><a href="#cb13-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-443"><a href="#cb13-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Scatterplot of haemoglobin, ferritin and transferrin receptor values in donating women aged 20-49</span></span>
<span id="cb13-444"><a href="#cb13-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb13-445"><a href="#cb13-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| - Haemoglobin</span></span>
<span id="cb13-446"><a href="#cb13-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| - sTfR</span></span>
<span id="cb13-447"><a href="#cb13-447" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb13-448"><a href="#cb13-448" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb13-449"><a href="#cb13-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-450"><a href="#cb13-450" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> donors_oi, <span class="fu">aes</span>(<span class="at">x =</span> Ferritin, <span class="at">y =</span> Hb)) <span class="sc">+</span> </span>
<span id="cb13-451"><a href="#cb13-451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb13-452"><a href="#cb13-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">formula =</span>  y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cr"</span>)) <span class="sc">+</span></span>
<span id="cb13-453"><a href="#cb13-453" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-454"><a href="#cb13-454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-455"><a href="#cb13-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"15 ug/L"</span>, <span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb13-456"><a href="#cb13-456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"25 ug/L"</span>, <span class="at">x =</span> <span class="dv">34</span>, <span class="at">y =</span> <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb13-457"><a href="#cb13-457" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb13-458"><a href="#cb13-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-459"><a href="#cb13-459" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"When will hemogobin start to fall off?"</span>,</span>
<span id="cb13-460"><a href="#cb13-460" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span id="cb13-461"><a href="#cb13-461" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span id="cb13-462"><a href="#cb13-462" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Hemoglobin (g/L)"</span>)</span>
<span id="cb13-463"><a href="#cb13-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-464"><a href="#cb13-464" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> donors_oi, <span class="fu">aes</span>(<span class="at">x =</span> Ferritin, <span class="at">y =</span> TransferrinR)) <span class="sc">+</span> </span>
<span id="cb13-465"><a href="#cb13-465" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb13-466"><a href="#cb13-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">formula =</span>  y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cr"</span>)) <span class="sc">+</span></span>
<span id="cb13-467"><a href="#cb13-467" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">15</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-468"><a href="#cb13-468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">25</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-469"><a href="#cb13-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"15 ug/L"</span>, <span class="at">x =</span> <span class="dv">7</span>, <span class="at">y =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb13-470"><a href="#cb13-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"25 ug/L"</span>, <span class="at">x =</span> <span class="dv">34</span>, <span class="at">y =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb13-471"><a href="#cb13-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb13-472"><a href="#cb13-472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-473"><a href="#cb13-473" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"When will sTfR start to rise?"</span>,</span>
<span id="cb13-474"><a href="#cb13-474" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"WHO: maybe at 15 ug/L. Mei &amp; Addo et al.: 25 ug/L."</span>,</span>
<span id="cb13-475"><a href="#cb13-475" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Ferritin (μg/L)"</span>,</span>
<span id="cb13-476"><a href="#cb13-476" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"sTfR (mg/L)"</span>)</span>
<span id="cb13-477"><a href="#cb13-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-478"><a href="#cb13-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-479"><a href="#cb13-479" aria-hidden="true" tabindex="-1"></a>The inflection points for both haemoglobin and sTfR are not as clear as with haemoglobin in the Health 200 cohort. This is probably a donor selection process effect.</span>
<span id="cb13-480"><a href="#cb13-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-481"><a href="#cb13-481" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting restricted cubic splines | FinDonor</span></span>
<span id="cb13-482"><a href="#cb13-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-485"><a href="#cb13-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-486"><a href="#cb13-486" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: set-datadist-findonor</span></span>
<span id="cb13-487"><a href="#cb13-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-488"><a href="#cb13-488" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">datadist</span>(donors_oi)</span>
<span id="cb13-489"><a href="#cb13-489" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"d"</span>)</span>
<span id="cb13-490"><a href="#cb13-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-491"><a href="#cb13-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-494"><a href="#cb13-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-495"><a href="#cb13-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-models-h2000-haem</span></span>
<span id="cb13-496"><a href="#cb13-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-497"><a href="#cb13-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Fitting with knots from 3 to 12 | Haemoglobin</span></span>
<span id="cb13-498"><a href="#cb13-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-499"><a href="#cb13-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-500"><a href="#cb13-500" aria-hidden="true" tabindex="-1"></a>hb3_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">3</span>), </span>
<span id="cb13-501"><a href="#cb13-501" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-502"><a href="#cb13-502" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-503"><a href="#cb13-503" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-504"><a href="#cb13-504" aria-hidden="true" tabindex="-1"></a>hb4_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">4</span>), </span>
<span id="cb13-505"><a href="#cb13-505" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-506"><a href="#cb13-506" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-507"><a href="#cb13-507" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-508"><a href="#cb13-508" aria-hidden="true" tabindex="-1"></a>hb5_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">5</span>), </span>
<span id="cb13-509"><a href="#cb13-509" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-510"><a href="#cb13-510" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-511"><a href="#cb13-511" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-512"><a href="#cb13-512" aria-hidden="true" tabindex="-1"></a>hb6_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">6</span>), </span>
<span id="cb13-513"><a href="#cb13-513" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-514"><a href="#cb13-514" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-515"><a href="#cb13-515" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-516"><a href="#cb13-516" aria-hidden="true" tabindex="-1"></a>hb7_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">7</span>), </span>
<span id="cb13-517"><a href="#cb13-517" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-518"><a href="#cb13-518" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-519"><a href="#cb13-519" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-520"><a href="#cb13-520" aria-hidden="true" tabindex="-1"></a>hb8_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">8</span>), </span>
<span id="cb13-521"><a href="#cb13-521" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-522"><a href="#cb13-522" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-523"><a href="#cb13-523" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-524"><a href="#cb13-524" aria-hidden="true" tabindex="-1"></a>hb9_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">9</span>), </span>
<span id="cb13-525"><a href="#cb13-525" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-526"><a href="#cb13-526" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-527"><a href="#cb13-527" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-528"><a href="#cb13-528" aria-hidden="true" tabindex="-1"></a>hb10_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">10</span>), </span>
<span id="cb13-529"><a href="#cb13-529" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-530"><a href="#cb13-530" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-531"><a href="#cb13-531" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-532"><a href="#cb13-532" aria-hidden="true" tabindex="-1"></a>hb11_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">11</span>), </span>
<span id="cb13-533"><a href="#cb13-533" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-534"><a href="#cb13-534" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-535"><a href="#cb13-535" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-536"><a href="#cb13-536" aria-hidden="true" tabindex="-1"></a>hb12_fd <span class="ot">&lt;-</span> <span class="fu">ols</span>(Hb <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">12</span>), </span>
<span id="cb13-537"><a href="#cb13-537" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-538"><a href="#cb13-538" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-539"><a href="#cb13-539" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-540"><a href="#cb13-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-541"><a href="#cb13-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-544"><a href="#cb13-544" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-545"><a href="#cb13-545" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-models-h2000-stfr</span></span>
<span id="cb13-546"><a href="#cb13-546" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-547"><a href="#cb13-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Fitting with knots from 3 to 12 | sTfR</span></span>
<span id="cb13-548"><a href="#cb13-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-549"><a href="#cb13-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-550"><a href="#cb13-550" aria-hidden="true" tabindex="-1"></a>stfr3 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">3</span>), </span>
<span id="cb13-551"><a href="#cb13-551" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-552"><a href="#cb13-552" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-553"><a href="#cb13-553" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-554"><a href="#cb13-554" aria-hidden="true" tabindex="-1"></a>stfr4 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">4</span>), </span>
<span id="cb13-555"><a href="#cb13-555" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-556"><a href="#cb13-556" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-557"><a href="#cb13-557" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-558"><a href="#cb13-558" aria-hidden="true" tabindex="-1"></a>stfr5 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">5</span>), </span>
<span id="cb13-559"><a href="#cb13-559" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-560"><a href="#cb13-560" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-561"><a href="#cb13-561" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-562"><a href="#cb13-562" aria-hidden="true" tabindex="-1"></a>stfr6 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">6</span>), </span>
<span id="cb13-563"><a href="#cb13-563" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-564"><a href="#cb13-564" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-565"><a href="#cb13-565" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-566"><a href="#cb13-566" aria-hidden="true" tabindex="-1"></a>stfr7 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">7</span>), </span>
<span id="cb13-567"><a href="#cb13-567" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-568"><a href="#cb13-568" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-569"><a href="#cb13-569" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-570"><a href="#cb13-570" aria-hidden="true" tabindex="-1"></a>stfr8 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">8</span>), </span>
<span id="cb13-571"><a href="#cb13-571" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-572"><a href="#cb13-572" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-573"><a href="#cb13-573" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-574"><a href="#cb13-574" aria-hidden="true" tabindex="-1"></a>stfr9 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">9</span>), </span>
<span id="cb13-575"><a href="#cb13-575" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> donors_oi, </span>
<span id="cb13-576"><a href="#cb13-576" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-577"><a href="#cb13-577" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-578"><a href="#cb13-578" aria-hidden="true" tabindex="-1"></a>stfr10 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">10</span>), </span>
<span id="cb13-579"><a href="#cb13-579" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-580"><a href="#cb13-580" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-581"><a href="#cb13-581" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-582"><a href="#cb13-582" aria-hidden="true" tabindex="-1"></a>stfr11 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">11</span>), </span>
<span id="cb13-583"><a href="#cb13-583" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-584"><a href="#cb13-584" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-585"><a href="#cb13-585" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-586"><a href="#cb13-586" aria-hidden="true" tabindex="-1"></a>stfr12 <span class="ot">&lt;-</span> <span class="fu">ols</span>(TransferrinR <span class="sc">~</span> <span class="fu">rcs</span>(Ferritin, <span class="dv">12</span>), </span>
<span id="cb13-587"><a href="#cb13-587" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> donors_oi, </span>
<span id="cb13-588"><a href="#cb13-588" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="cn">TRUE</span>, </span>
<span id="cb13-589"><a href="#cb13-589" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-590"><a href="#cb13-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-591"><a href="#cb13-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-594"><a href="#cb13-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-595"><a href="#cb13-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-AIC-FinDonor-haem</span></span>
<span id="cb13-596"><a href="#cb13-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-597"><a href="#cb13-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Computing the AICs | Haemoglobin</span></span>
<span id="cb13-598"><a href="#cb13-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-599"><a href="#cb13-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-600"><a href="#cb13-600" aria-hidden="true" tabindex="-1"></a>Hb_AIC_fd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">AIC</span>(hb3_fd),</span>
<span id="cb13-601"><a href="#cb13-601" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb4_fd), </span>
<span id="cb13-602"><a href="#cb13-602" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb5_fd), </span>
<span id="cb13-603"><a href="#cb13-603" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb6_fd), </span>
<span id="cb13-604"><a href="#cb13-604" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb7_fd), </span>
<span id="cb13-605"><a href="#cb13-605" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb8_fd), </span>
<span id="cb13-606"><a href="#cb13-606" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb9_fd), </span>
<span id="cb13-607"><a href="#cb13-607" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb10_fd), </span>
<span id="cb13-608"><a href="#cb13-608" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb11_fd), </span>
<span id="cb13-609"><a href="#cb13-609" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(hb12_fd))</span>
<span id="cb13-610"><a href="#cb13-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-611"><a href="#cb13-611" aria-hidden="true" tabindex="-1"></a>Hb_AIC_min_fd <span class="ot">&lt;-</span> <span class="fu">min</span>(Hb_AIC_fd)</span>
<span id="cb13-612"><a href="#cb13-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-613"><a href="#cb13-613" aria-hidden="true" tabindex="-1"></a>Hb_AIC_mindiff_fd <span class="ot">&lt;-</span> Hb_AIC_fd <span class="sc">-</span> Hb_AIC_min_fd</span>
<span id="cb13-614"><a href="#cb13-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-615"><a href="#cb13-615" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb13-616"><a href="#cb13-616" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>Hb_AIC_mindiff_fd <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb13-617"><a href="#cb13-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-618"><a href="#cb13-618" aria-hidden="true" tabindex="-1"></a>hb_AIC_df_fd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">knots =</span> knots,</span>
<span id="cb13-619"><a href="#cb13-619" aria-hidden="true" tabindex="-1"></a>                        <span class="at">AIC_delta =</span> Hb_AIC_mindiff_fd,</span>
<span id="cb13-620"><a href="#cb13-620" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probs =</span> probs)</span>
<span id="cb13-621"><a href="#cb13-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-622"><a href="#cb13-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-625"><a href="#cb13-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-626"><a href="#cb13-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-AIC-FinDonor-stfr</span></span>
<span id="cb13-627"><a href="#cb13-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb13-628"><a href="#cb13-628" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Computing the AICs | sTfR</span></span>
<span id="cb13-629"><a href="#cb13-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-630"><a href="#cb13-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-631"><a href="#cb13-631" aria-hidden="true" tabindex="-1"></a>stfr_AIC <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">AIC</span>(stfr3),</span>
<span id="cb13-632"><a href="#cb13-632" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr4), </span>
<span id="cb13-633"><a href="#cb13-633" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr5), </span>
<span id="cb13-634"><a href="#cb13-634" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr6), </span>
<span id="cb13-635"><a href="#cb13-635" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr7), </span>
<span id="cb13-636"><a href="#cb13-636" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr8), </span>
<span id="cb13-637"><a href="#cb13-637" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr9), </span>
<span id="cb13-638"><a href="#cb13-638" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr10), </span>
<span id="cb13-639"><a href="#cb13-639" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr11), </span>
<span id="cb13-640"><a href="#cb13-640" aria-hidden="true" tabindex="-1"></a>            <span class="fu">AIC</span>(stfr12))</span>
<span id="cb13-641"><a href="#cb13-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-642"><a href="#cb13-642" aria-hidden="true" tabindex="-1"></a>stfr_AIC_min <span class="ot">&lt;-</span> <span class="fu">min</span>(stfr_AIC)</span>
<span id="cb13-643"><a href="#cb13-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-644"><a href="#cb13-644" aria-hidden="true" tabindex="-1"></a>stfr_AIC_mindiff <span class="ot">&lt;-</span> stfr_AIC <span class="sc">-</span> stfr_AIC_min</span>
<span id="cb13-645"><a href="#cb13-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-646"><a href="#cb13-646" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb13-647"><a href="#cb13-647" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>stfr_AIC_mindiff <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb13-648"><a href="#cb13-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-649"><a href="#cb13-649" aria-hidden="true" tabindex="-1"></a>stfr_AIC_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">knots =</span> knots,</span>
<span id="cb13-650"><a href="#cb13-650" aria-hidden="true" tabindex="-1"></a>                        <span class="at">AIC_delta =</span> stfr_AIC_mindiff,</span>
<span id="cb13-651"><a href="#cb13-651" aria-hidden="true" tabindex="-1"></a>                        <span class="at">probs =</span> probs)</span>
<span id="cb13-652"><a href="#cb13-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-653"><a href="#cb13-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-656"><a href="#cb13-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-657"><a href="#cb13-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-AIC-FinDonor</span></span>
<span id="cb13-658"><a href="#cb13-658" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-659"><a href="#cb13-659" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-660"><a href="#cb13-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Comparing AICs of restricted cubic spline models with varying numbers of knots. FinDonor.</span></span>
<span id="cb13-661"><a href="#cb13-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb13-662"><a href="#cb13-662" aria-hidden="true" tabindex="-1"></a><span class="co">#| - Haemoglobin</span></span>
<span id="cb13-663"><a href="#cb13-663" aria-hidden="true" tabindex="-1"></a><span class="co">#| - sTfR</span></span>
<span id="cb13-664"><a href="#cb13-664" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb13-665"><a href="#cb13-665" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb13-666"><a href="#cb13-666" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-667"><a href="#cb13-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-668"><a href="#cb13-668" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> hb_AIC_df_fd, <span class="fu">aes</span>(<span class="at">x =</span> knots, </span>
<span id="cb13-669"><a href="#cb13-669" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> AIC_delta)) <span class="sc">+</span></span>
<span id="cb13-670"><a href="#cb13-670" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-671"><a href="#cb13-671" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span>, </span>
<span id="cb13-672"><a href="#cb13-672" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-673"><a href="#cb13-673" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-674"><a href="#cb13-674" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span>, </span>
<span id="cb13-675"><a href="#cb13-675" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-676"><a href="#cb13-676" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb13-677"><a href="#cb13-677" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">7</span>, </span>
<span id="cb13-678"><a href="#cb13-678" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-679"><a href="#cb13-679" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"yellow"</span>) <span class="sc">+</span></span>
<span id="cb13-680"><a href="#cb13-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparing AICs of restricted cubic spline models"</span>,</span>
<span id="cb13-681"><a href="#cb13-681" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"FinDonor | Haemoglobin ~ Ferritin"</span>,</span>
<span id="cb13-682"><a href="#cb13-682" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of knots in an RCS model"</span>,</span>
<span id="cb13-683"><a href="#cb13-683" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">bquote</span>(Delta[i] <span class="sc">~</span> <span class="st">" = "</span> <span class="sc">~</span> AIC[min] <span class="sc">~</span> <span class="st">" - "</span> <span class="sc">~</span> AIC[i])) <span class="sc">+</span></span>
<span id="cb13-684"><a href="#cb13-684" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb13-685"><a href="#cb13-685" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb13-686"><a href="#cb13-686" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> knots, <span class="at">y =</span> AIC_delta <span class="sc">+</span> <span class="dv">1</span>, <span class="at">xend =</span> knots, <span class="at">yend =</span> AIC_delta <span class="sc">+</span> <span class="dv">3</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb13-687"><a href="#cb13-687" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(probs, <span class="dv">2</span>), <span class="st">"%"</span>)), <span class="at">nudge_y =</span> <span class="dv">4</span>, <span class="at">nudge_x =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb13-688"><a href="#cb13-688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb13-689"><a href="#cb13-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-690"><a href="#cb13-690" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> stfr_AIC_df, <span class="fu">aes</span>(<span class="at">x =</span> knots, </span>
<span id="cb13-691"><a href="#cb13-691" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> AIC_delta)) <span class="sc">+</span></span>
<span id="cb13-692"><a href="#cb13-692" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-693"><a href="#cb13-693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">2</span>, </span>
<span id="cb13-694"><a href="#cb13-694" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-695"><a href="#cb13-695" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-696"><a href="#cb13-696" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">4</span>, </span>
<span id="cb13-697"><a href="#cb13-697" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-698"><a href="#cb13-698" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb13-699"><a href="#cb13-699" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">7</span>, </span>
<span id="cb13-700"><a href="#cb13-700" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb13-701"><a href="#cb13-701" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"yellow"</span>) <span class="sc">+</span></span>
<span id="cb13-702"><a href="#cb13-702" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparing AICs of restricted cubic spline models"</span>,</span>
<span id="cb13-703"><a href="#cb13-703" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"FinDonor | sTfR ~ Ferritin"</span>,</span>
<span id="cb13-704"><a href="#cb13-704" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Number of knots in an RCS model"</span>,</span>
<span id="cb13-705"><a href="#cb13-705" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">bquote</span>(Delta[i] <span class="sc">~</span> <span class="st">" = "</span> <span class="sc">~</span> AIC[min] <span class="sc">~</span> <span class="st">" - "</span> <span class="sc">~</span> AIC[i])) <span class="sc">+</span></span>
<span id="cb13-706"><a href="#cb13-706" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb13-707"><a href="#cb13-707" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">26</span>)) <span class="sc">+</span></span>
<span id="cb13-708"><a href="#cb13-708" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> knots, <span class="at">y =</span> AIC_delta <span class="sc">+</span> <span class="dv">1</span>, <span class="at">xend =</span> knots, <span class="at">yend =</span> AIC_delta <span class="sc">+</span> <span class="dv">5</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb13-709"><a href="#cb13-709" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(probs, <span class="dv">2</span>), <span class="st">"%"</span>)), <span class="at">nudge_y =</span> <span class="fl">6.5</span>, <span class="at">nudge_x =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb13-710"><a href="#cb13-710" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb13-711"><a href="#cb13-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-712"><a href="#cb13-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-713"><a href="#cb13-713" aria-hidden="true" tabindex="-1"></a>@fig-AIC-FinDonor reveals that the AIC is minimized at different knots for haemoglobin and sTfR, 5 and 7, respectively. However, the haemoglobin 7 knot model has still quite a lot of support for it, being at 39\% chance of being the AIC minimizing model. The evidence gets weaker fast, though, as we move up the knot ladder.</span>
<span id="cb13-714"><a href="#cb13-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-715"><a href="#cb13-715" aria-hidden="true" tabindex="-1"></a>We probably shouldn't be encouraged to move upwards the model complexity curve just because we can credibly match knot numbers for two different iron deficiency indicators, but let's see what the 7 knot models look like.</span>
<span id="cb13-716"><a href="#cb13-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-719"><a href="#cb13-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-720"><a href="#cb13-720" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-FinDonor-7s</span></span>
<span id="cb13-721"><a href="#cb13-721" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-722"><a href="#cb13-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-723"><a href="#cb13-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 7 knot models for the FinDonor cohort (haemoglobin and sTfR)</span></span>
<span id="cb13-724"><a href="#cb13-724" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb13-725"><a href="#cb13-725" aria-hidden="true" tabindex="-1"></a><span class="co">#| - Haemoglobin</span></span>
<span id="cb13-726"><a href="#cb13-726" aria-hidden="true" tabindex="-1"></a><span class="co">#| - sTfR</span></span>
<span id="cb13-727"><a href="#cb13-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb13-728"><a href="#cb13-728" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb13-729"><a href="#cb13-729" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-730"><a href="#cb13-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-731"><a href="#cb13-731" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb7_fd)) <span class="sc">+</span></span>
<span id="cb13-732"><a href="#cb13-732" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">21.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-733"><a href="#cb13-733" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"21.5 μg/L"</span>, <span class="at">x =</span> <span class="dv">30</span>, <span class="at">y =</span> <span class="dv">140</span>) <span class="sc">+</span></span>
<span id="cb13-734"><a href="#cb13-734" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-735"><a href="#cb13-735" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-736"><a href="#cb13-736" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb7_fd))),</span>
<span id="cb13-737"><a href="#cb13-737" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-738"><a href="#cb13-738" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-739"><a href="#cb13-739" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-740"><a href="#cb13-740" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-741"><a href="#cb13-741" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-742"><a href="#cb13-742" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-743"><a href="#cb13-743" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-744"><a href="#cb13-744" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 7 knots"</span>,</span>
<span id="cb13-745"><a href="#cb13-745" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Donating women 20-49 y.o."</span>,</span>
<span id="cb13-746"><a href="#cb13-746" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-747"><a href="#cb13-747" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-748"><a href="#cb13-748" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-749"><a href="#cb13-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-750"><a href="#cb13-750" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(stfr7)) <span class="sc">+</span></span>
<span id="cb13-751"><a href="#cb13-751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">19</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb13-752"><a href="#cb13-752" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"19 μg/L"</span>, <span class="at">x =</span> <span class="dv">27</span>, <span class="at">y =</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb13-753"><a href="#cb13-753" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-754"><a href="#cb13-754" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-755"><a href="#cb13-755" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(stfr7))),</span>
<span id="cb13-756"><a href="#cb13-756" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-757"><a href="#cb13-757" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">6</span></span>
<span id="cb13-758"><a href="#cb13-758" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-759"><a href="#cb13-759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-760"><a href="#cb13-760" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-761"><a href="#cb13-761" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-762"><a href="#cb13-762" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-763"><a href="#cb13-763" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 7 knots"</span>,</span>
<span id="cb13-764"><a href="#cb13-764" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Donating women 20-49 y.o."</span>,</span>
<span id="cb13-765"><a href="#cb13-765" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-766"><a href="#cb13-766" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"sTfR (g/L)"</span></span>
<span id="cb13-767"><a href="#cb13-767" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-768"><a href="#cb13-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-769"><a href="#cb13-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-770"><a href="#cb13-770" aria-hidden="true" tabindex="-1"></a>It's encouraging that the threshold is around the same ballpark for both of these at knot number 7. However, let us not forget the reality of the matter, there are other viable fits available:</span>
<span id="cb13-771"><a href="#cb13-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-774"><a href="#cb13-774" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-775"><a href="#cb13-775" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-FinDonor-haem-5</span></span>
<span id="cb13-776"><a href="#cb13-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-777"><a href="#cb13-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-778"><a href="#cb13-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 5 knot model for haemoglobin (FinDonor)</span></span>
<span id="cb13-779"><a href="#cb13-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-780"><a href="#cb13-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-781"><a href="#cb13-781" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(hb5_fd)) <span class="sc">+</span></span>
<span id="cb13-782"><a href="#cb13-782" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-783"><a href="#cb13-783" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-784"><a href="#cb13-784" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(hb5_fd))),</span>
<span id="cb13-785"><a href="#cb13-785" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-786"><a href="#cb13-786" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">144</span></span>
<span id="cb13-787"><a href="#cb13-787" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-788"><a href="#cb13-788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-789"><a href="#cb13-789" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-790"><a href="#cb13-790" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-791"><a href="#cb13-791" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-792"><a href="#cb13-792" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 5 knots"</span>,</span>
<span id="cb13-793"><a href="#cb13-793" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Donating women 20-49 y.o."</span>,</span>
<span id="cb13-794"><a href="#cb13-794" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-795"><a href="#cb13-795" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Haemoglobin concentration (g/L)"</span></span>
<span id="cb13-796"><a href="#cb13-796" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-797"><a href="#cb13-797" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb13-798"><a href="#cb13-798" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb13-799"><a href="#cb13-799" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">128</span>,</span>
<span id="cb13-800"><a href="#cb13-800" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> <span class="dv">13</span>,</span>
<span id="cb13-801"><a href="#cb13-801" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> <span class="dv">134</span></span>
<span id="cb13-802"><a href="#cb13-802" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-803"><a href="#cb13-803" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb13-804"><a href="#cb13-804" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"0.75"</span>,</span>
<span id="cb13-805"><a href="#cb13-805" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">5</span>,</span>
<span id="cb13-806"><a href="#cb13-806" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">132</span>,</span>
<span id="cb13-807"><a href="#cb13-807" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb13-808"><a href="#cb13-808" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-809"><a href="#cb13-809" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb13-810"><a href="#cb13-810" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">17.5</span>,</span>
<span id="cb13-811"><a href="#cb13-811" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fl">136.27</span>,</span>
<span id="cb13-812"><a href="#cb13-812" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> <span class="dv">21</span>,</span>
<span id="cb13-813"><a href="#cb13-813" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> <span class="fl">137.05</span></span>
<span id="cb13-814"><a href="#cb13-814" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-815"><a href="#cb13-815" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb13-816"><a href="#cb13-816" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"0.24"</span>,</span>
<span id="cb13-817"><a href="#cb13-817" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">18</span>,</span>
<span id="cb13-818"><a href="#cb13-818" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">138</span>,</span>
<span id="cb13-819"><a href="#cb13-819" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb13-820"><a href="#cb13-820" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-821"><a href="#cb13-821" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(</span>
<span id="cb13-822"><a href="#cb13-822" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">30</span>,</span>
<span id="cb13-823"><a href="#cb13-823" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fl">137.9</span>,</span>
<span id="cb13-824"><a href="#cb13-824" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> <span class="dv">40</span>,</span>
<span id="cb13-825"><a href="#cb13-825" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> <span class="fl">138.9</span></span>
<span id="cb13-826"><a href="#cb13-826" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb13-827"><a href="#cb13-827" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(</span>
<span id="cb13-828"><a href="#cb13-828" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"0.1"</span>,</span>
<span id="cb13-829"><a href="#cb13-829" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">35</span>,</span>
<span id="cb13-830"><a href="#cb13-830" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fl">139.7</span>,</span>
<span id="cb13-831"><a href="#cb13-831" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"red"</span></span>
<span id="cb13-832"><a href="#cb13-832" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-833"><a href="#cb13-833" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-834"><a href="#cb13-834" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-835"><a href="#cb13-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-836"><a href="#cb13-836" aria-hidden="true" tabindex="-1"></a>@fig-FinDonor-haem-5 reveals that there are no zero derivatives within the range of interest for haemoglobin with 5 knots! There still is a turning point, but it can't be found via the zero of the first derivative of this function. Looking at the derivatives at select <span class="in">`x`</span> (the estimates here are visual), we can see that the change in the derivative is fastest somewhere between 15 and 20 μg/L.</span>
<span id="cb13-837"><a href="#cb13-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-838"><a href="#cb13-838" aria-hidden="true" tabindex="-1"></a>This is isn't the only fit with no plateau at the inflection point. Take a look at the sTfR 9 knot model:</span>
<span id="cb13-839"><a href="#cb13-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-842"><a href="#cb13-842" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb13-843"><a href="#cb13-843" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-FinDonor-stfr-9</span></span>
<span id="cb13-844"><a href="#cb13-844" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb13-845"><a href="#cb13-845" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb13-846"><a href="#cb13-846" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 9 knot model for sTfR (FinDonor)</span></span>
<span id="cb13-847"><a href="#cb13-847" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb13-848"><a href="#cb13-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-849"><a href="#cb13-849" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(stfr9)) <span class="sc">+</span></span>
<span id="cb13-850"><a href="#cb13-850" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-851"><a href="#cb13-851" aria-hidden="true" tabindex="-1"></a>        <span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb13-852"><a href="#cb13-852" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AIC:"</span>, <span class="fu">as.integer</span>(<span class="fu">AIC</span>(stfr9))),</span>
<span id="cb13-853"><a href="#cb13-853" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">110</span>,</span>
<span id="cb13-854"><a href="#cb13-854" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="dv">6</span></span>
<span id="cb13-855"><a href="#cb13-855" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb13-856"><a href="#cb13-856" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="dv">80</span>, <span class="dv">100</span>, <span class="dv">120</span>),</span>
<span id="cb13-857"><a href="#cb13-857" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb13-858"><a href="#cb13-858" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-859"><a href="#cb13-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-860"><a href="#cb13-860" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Restricted cubic spline, 9 knots"</span>,</span>
<span id="cb13-861"><a href="#cb13-861" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"Donating women 20-49 y.o."</span>,</span>
<span id="cb13-862"><a href="#cb13-862" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Serum ferritin concentrations (μg/L)"</span>,</span>
<span id="cb13-863"><a href="#cb13-863" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"sTfR (g/L)"</span></span>
<span id="cb13-864"><a href="#cb13-864" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-865"><a href="#cb13-865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb13-866"><a href="#cb13-866" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb13-867"><a href="#cb13-867" aria-hidden="true" tabindex="-1"></a>We're currently in talks with the original authors of these cubic spline derived thresholds, but the communication has not been very clear. We sent them our code to run this week, but have yet to heard from them.</span>
<span id="cb13-868"><a href="#cb13-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-869"><a href="#cb13-869" aria-hidden="true" tabindex="-1"></a>The main issue here is that if we suppose that there is a piecewise linear relationship between markers for iron-deficient erythropoiesis and serum ferritin levels, the whole idea of a zero derivative plateau makes no sense and raises the question of it being an artifact of the cubic spline model. We only expect to see a range where there is an effect, and a subsequent range where the effect disappears. Quantifying the behaviour of the derivative at the inflection point in a way that would be of use to anyone is much more difficult. Furthermore, different model specifications will position the inflection point differently, and we may want to instead distribut-ize the model parameters and extract the inflection points from those specifications that lie at the boundaries of our credibility intervals. This would require Bayesian modeling, an area I'm currently researching for this.</span>
<span id="cb13-870"><a href="#cb13-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-871"><a href="#cb13-871" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb13-872"><a href="#cb13-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-873"><a href="#cb13-873" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>World Health Organization. (2020). WHO guideline on use of ferritin concentrations to assess iron status in populations. World Health Organization. ISBN: 978-92-4-000012-4</span>
<span id="cb13-874"><a href="#cb13-874" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Mei Z, Addo OY, Jefferds ME, Sharma AJ, Flores-Ayala RC, Brittenham GM. Physiologically based serum ferritin thresholds for iron deficiency in children and non-pregnant women: a US National Health and Nutrition Examination Surveys (NHANES) serial cross-sectional study. The Lancet Haematology. 2021;8(8):e572-e582. doi:10.1016/S2352-3026(21)00168-X</span>
<span id="cb13-875"><a href="#cb13-875" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Addo OY, Mei Z, Hod EA, et al. Physiologically based serum ferritin thresholds for iron deficiency in women of reproductive age who are blood donors. Blood Advances. 2022;6(12):3661-3665. doi:10.1182/bloodadvances.2022007066</span>
<span id="cb13-876"><a href="#cb13-876" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Burnham KP, Anderson DR. Multimodel inference: understanding AIC and BIC in model selection. Sociological methods &amp; research. 2004;33(2):261-304. doi:10.1177/0049124104268644</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>